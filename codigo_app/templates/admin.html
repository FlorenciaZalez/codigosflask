<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Panel de Administración</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
    body {
        background-image: url('/static/631bcb91-5990-4e17-b510-9bcb514720f1.jpeg');
        background-attachment: fixed;
        background-repeat: no-repeat;
        background-size: cover;
        background-position: center;
    }

    .glass-card {
        background-color: #1f2937; /* Tailwind bg-gray-800 */
    }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center">
<div class="absolute top-20 left-1/2 transform -translate-x-1/2">
  <img src="{{ url_for('static', filename='assets/logolargo.png') }}" alt="Logo de Marca" class="w-36 h-auto rounded-lg shadow-lg">
</div>
<nav class="fixed top-0 left-0 w-full bg-gray-900 bg-opacity-90 text-white py-3 px-6 flex justify-between items-center shadow-lg z-50">
<div class="flex items-center gap-2">
    <img src="https://cdn-icons-png.flaticon.com/512/9187/9187604.png" alt="admin icon" class="w-6 h-6">
    <span class="font-bold text-lg">Panel de Administración</span>
</div>
<div class="flex items-center gap-4">
    <a href="/home" class="hover:underline text-purple-400">Inicio</a>
    <a href="/logout" class="hover:underline text-red-400">Cerrar sesión</a>
</div>
</nav>
<div class="bg-gray-900 text-white rounded-lg shadow-lg p-8 w-full max-w-6xl mt-24">

    <!-- Historial -->
    <section class="mb-10">
    <h3 class="text-xl font-semibold mb-4">Filtrar historial</h3>
    <form method="get" action="#historial" class="glass-card p-4 rounded shadow-inner">
        <div class="flex flex-col md:flex-row gap-4">
            <div class="w-full md:w-1/2">
                <label class="block text-sm font-medium">Usuario:</label>
                <select name="usuario_filtro" class="w-full border rounded px-2 py-1 text-black">
                    <option value="">Todos</option>
                    {% for user in usuarios_historial %}
                    <option value="{{ user }}" {% if request.args.get('usuario_filtro') == user %}selected{% endif %}>{{ user }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="w-full md:w-1/2">
                <label class="block text-sm font-medium">Cuenta:</label>
                <select name="cuenta_filtro" class="w-full border rounded px-2 py-1 text-black">
                    <option value="">Todas</option>
                    {% for cta in cuentas_historial %}
                    <option value="{{ cta }}" {% if request.args.get('cuenta_filtro') == cta %}selected{% endif %}>{{ cta }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="flex flex-col md:flex-row gap-4 mt-4">
            <div class="w-full md:w-1/2">
                <label class="block text-sm font-medium">Desde:</label>
                <input type="date" name="fecha_inicio" value="{{ request.args.get('fecha_inicio', '') }}" class="w-full border rounded px-2 py-1 text-black">
            </div>
            <div class="w-full md:w-1/2">
                <label class="block text-sm font-medium">Hasta:</label>
                <input type="date" name="fecha_fin" value="{{ request.args.get('fecha_fin', '') }}" class="w-full border rounded px-2 py-1 text-black">
            </div>
        </div>
        <div class="flex flex-col md:flex-row gap-4 mt-4">
            <button type="submit" class="bg-purple-600 text-white px-6 py-3 rounded-full hover:bg-purple-700 w-full md:w-1/2">Filtrar</button>
            <a href="/admin#historial" class="bg-gray-300 text-black px-6 py-3 rounded-full hover:bg-gray-400 w-full md:w-1/2 text-center text-sm flex items-center justify-center">Quitar filtros</a>
        </div>
    </form>
    </section>
    <hr class="border-t border-white my-6">

    <!-- Tabla de historial -->
    <section class="mb-10">
    <h3 class="text-xl font-semibold mb-4">Historial de entregas</h3>
    <div class="overflow-x-auto">
        <table class="min-w-full bg-white shadow rounded overflow-hidden">
        <thead class="bg-purple-100 text-purple-800">
            <tr>
            <th class="px-4 py-2 text-left">Usuario</th>
            <th class="px-4 py-2 text-left">Cuenta</th>
            <th class="px-4 py-2 text-left">Código</th>
            <th class="px-4 py-2 text-left">Fecha</th>
            </tr>
        </thead>
        <tbody>
            {% for usuario, cuenta, codigo, fecha in historial %}
            <tr class="border-t">
                <td class="px-4 py-2">{{ usuario }}</td>
                <td class="px-4 py-2">{{ cuenta }}</td>
                <td class="px-4 py-2">{{ codigo }}</td>
                <td class="px-4 py-2">{{ fecha }}</td>
            </tr>
            {% endfor %}
        </tbody>
        </table>
    </div>
    </section>
    <hr class="border-t border-white my-6">

    <!-- Cargar código -->
    <section class="mb-10">

    <form method="post" class="glass-card p-4 rounded shadow-inner flex flex-col gap-3">
        <input type="text" name="cuenta" placeholder="Número de cuenta" required class="border rounded px-2 py-1 text-black">
        <input type="text" name="codigo" placeholder="Nuevo código" required class="border rounded px-2 py-1 text-black">
        <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded-full hover:bg-purple-700">Agregar código</button>
    </form>
    {% if mensaje_codigo %}
        <p class="text-sm mt-2 text-green-700">{{ mensaje_codigo }}</p>
    {% endif %}

    </section>
    <hr class="border-t border-white my-6">

    <!-- Crear usuario -->
    <section class="mb-10">
    <h3 class="text-xl font-semibold mb-4">Crear nuevo usuario</h3>
    <form method="post" class="glass-card p-4 rounded shadow-inner flex flex-col gap-3">
        <input type="text" name="nuevo_usuario" placeholder="Nombre de usuario" required class="border rounded px-2 py-1 text-black">
        <input type="password" name="nueva_contraseña" placeholder="Contraseña" required class="border rounded px-2 py-1 text-black">
        <select name="rol" class="border border-gray-500 bg-gray-700 text-white rounded px-2 py-1 appearance-none relative text-black">
        <option value="cliente">Cliente</option>
        <option value="admin">Admin</option>
        </select>
        <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded-full hover:bg-purple-700">Crear usuario</button>
    </form>
    {% if mensaje_usuario %}
        <p class="text-sm mt-2 text-blue-700">{{ mensaje_usuario }}</p>
    {% endif %}
    </section>
    <hr class="border-t border-white my-6">


    <!-- CSV de códigos cliente -->
    <section class="mb-10">
    <h3 class="text-xl font-semibold mb-4">Subir CSV de códigos de cliente</h3>
    <form method="post" enctype="multipart/form-data" class="glass-card p-4 rounded shadow-inner flex flex-col gap-3">
        <div class="flex flex-col gap-2">
          <label for="archivo_codigos_cliente" class="text-sm text-white">Seleccionar archivo CSV</label>
          <input type="file" name="archivo_codigos_cliente" id="archivo_codigos_cliente" accept=".csv" required class="text-sm text-white bg-gray-800 rounded px-4 py-2 border border-gray-600 file:hidden">
          <label id="nombre-archivo-2" class="text-sm text-gray-400 truncate">Ningún archivo seleccionado</label>
        </div>
        <button type="submit" class="bg-purple-600 text-white px-4 py-2 rounded-full hover:bg-purple-700">Cargar archivo</button>
    </form>
    {% if mensaje_codigos_cliente %}
        <p class="text-sm mt-2 text-indigo-700">{{ mensaje_codigos_cliente }}</p>
    {% endif %}
    {% if debug_codigos_cliente %}
        <ul class="text-sm mt-2 text-green-500 list-disc list-inside">
            {% for linea in debug_codigos_cliente %}
                <li>{{ linea }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    </section> 
    <hr class="border-t border-white my-6">

</div>
<script>
document.querySelectorAll('input[type="file"]').forEach((input, i) => {
    input.addEventListener('change', (e) => {
    const fileName = e.target.files.length ? e.target.files[0].name : 'Ningún archivo seleccionado';
    const label = document.getElementById(`nombre-archivo-${i + 1}`);
    if (label) label.textContent = fileName;
    });
});
</script>
</body>
</html>